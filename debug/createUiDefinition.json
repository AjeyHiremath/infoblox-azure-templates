{
  "handler": "Microsoft.Compute.MultiVm",
  "version": "0.0.1-preview",
  "parameters": {
    "basics": [
      {
        "name": "niosModel",
        "type": "Microsoft.Common.DropDown",
        "label": "NIOS model",
        "defaultValue": "TE-V1420 (Standard DS3)",
        "toolTip": "Select the NIOS model to load on the new VM",
        "constraints": {
          "allowedValues": [
            {
              "label": "TE-V820 (Standard DS2)",
              "value": "vnios-te-v820"
            },
            {
              "label": "TE-V1420 (Standard DS3)",
              "value": "vnios-te-v1420"
            },
            {
              "label": "TE-V2220 (Standard DS3)",
              "value": "vnios-te-v2220"
            },
            {
              "label": "CP-V800 (Standard DS2)",
              "value": "vnios-cp-v800"
            },
            {
              "label": "CP-V1400 (Standard DS3)",
              "value": "vnios-cp-v1400"
            },
            {
              "label": "CP-V2200 (Standard DS3)",
              "value": "vnios-cp-v2200"
            }
          ]
        },
        "visible": true
      }
    ],
    "steps": [{
      "name": "vmSettings",
      "label": "VM Settings",
      "bladeTitle": "NIOS VM settings",
      "subLabel": {
        "preValidation": "Configure VM Settings",
        "postValidation": "Done"
      },
      "elements": [
        {
          "name": "niosVersion-vnios-te-v820",
          "type": "Microsoft.Common.DropDown",
          "label": "NIOS version for TE-V820",
          "defaultValue": "7.4.0",
          "toolTip": "Select the version of NIOS to load",
          "constraints": {
            "allowedValues": [
              {
                "label": "7.4.0",
                "value": "74.0.331933"
              }
            ]
          },
          "visible": "[equals(basics('niosModel'), 'vnios-te-v820')]"
        },
        {
          "name": "niosVersion-vnios-te-v1420",
          "type": "Microsoft.Common.DropDown",
          "label": "NIOS version for TE-V1420",
          "defaultValue": "7.4.0",
          "toolTip": "Select the version of NIOS to load",
          "constraints": {
            "allowedValues": [
              {
                "label": "7.4.0",
                "value": "74.0.331933"
              }
            ]
          },
          "visible": "[equals(basics('niosModel'), 'vnios-te-v1420')]"
        },
        {
          "name": "niosVersion-vnios-te-v2220",
          "type": "Microsoft.Common.DropDown",
          "label": "NIOS version for TE-V2220",
          "defaultValue": "7.4.0",
          "toolTip": "Select the version of NIOS to load",
          "constraints": {
            "allowedValues": [
              {
                "label": "7.4.0",
                "value": "74.0.337462"
              }
            ]
          },
          "visible": "[equals(basics('niosModel'), 'vnios-te-v2220')]"
        },
        {
          "name": "niosVersion-vnios-cp-v800",
          "type": "Microsoft.Common.DropDown",
          "label": "NIOS version for CP-V800",
          "defaultValue": "7.4.0",
          "toolTip": "Select the version of NIOS to load",
          "constraints": {
            "allowedValues": [
              {
                "label": "7.4.0",
                "value": "74.0.331933"
              }
            ]
          },
          "visible": "[equals(basics('niosModel'), 'vnios-cp-v800')]"
        },
        {
          "name": "niosVersion-vnios-cp-v1400",
          "type": "Microsoft.Common.DropDown",
          "label": "NIOS version for CP-V1400",
          "defaultValue": "7.4.0",
          "toolTip": "Select the version of NIOS to load",
          "constraints": {
            "allowedValues": [
              {
                "label": "7.4.0",
                "value": "74.0.331933"
              }
            ]
          },
          "visible": "[equals(basics('niosModel'), 'vnios-cp-v1400')]"
        },
        {
          "name": "niosVersion-vnios-cp-v2200",
          "type": "Microsoft.Common.DropDown",
          "label": "NIOS version for CP-V2200",
          "defaultValue": "7.4.0",
          "toolTip": "Select the version of NIOS to load",
          "constraints": {
            "allowedValues": [
              {
                "label": "7.4.0",
                "value": "74.0.331933"
              }
            ]
          },
          "visible": "[equals(basics('niosModel'), 'vnios-cp-v2200')]"
        },
        {
          "name": "availabilitySection",
          "type": "Microsoft.Common.Section",
           "label": "Availability",
           "elements": [
            {
              "name": "availabilitySetNewOrExistingOrNone",
              "type": "Microsoft.Common.OptionsGroup",
              "label": "Availability set",
              "defaultValue": "None",
              "toolTip": "Select the availability set option for the VM",
              "constraints": {
                "allowedValues": [
                  {
                    "label": "None",
                    "value": "none"
                  },
                  {
                    "label": "New",
                    "value": "new"
                  },
                  {
                    "label": "Existing",
                    "value": "existing"
                  }
                ]
              },
              "visible": true
            },
            {
              "name": "availabilitySetName",
              "type": "Microsoft.Common.TextBox",
              "label": "Availability set name",
              "toolTip": "Enter either the exact name of 'Existing' availability set to select, or the name of the 'New' availability set to create",
              "constraints": {
                "required": false,
                "regex": "^[^_\\W][\\w-.]{0,78}[\\w]$",
                "validationMessage": "The length must be between 2 and 80 characters. The first character must be a letter or number. The last character must be a letter, number, or underscore. The remaining characters must be letters, numbers, periods, underscores, or dashes."
              },
              "visible": true
            }
          ],
          "visible": true
        },
        {
          "name": "licenseSection",
          "type": "Microsoft.Common.Section",
          "label": "Licenses",
          "elements": [
            {
              "name": "license1",
              "type": "Microsoft.Common.OptionsGroup",
              "label": "Install temporary vNIOS license",
              "defaultValue": "yes",
              "toolTip": "Select yes if you want to install temporary vNIOS license",
              "constraints": {
                "allowedValues": [
                  {
                    "label": "yes",
                    "value": "vnios "
                  },
                  {
                    "label": "no",
                    "value": ""
                  }
                ]
              },
              "visible": true
            },
            {
              "name": "license2",
              "type": "Microsoft.Common.OptionsGroup",
              "label": "Install temporary Grid license",
              "defaultValue": "yes",
              "toolTip": "Select yes if you want to install temporary Grid license",
              "constraints": {
                "allowedValues": [
                  {
                    "label": "yes",
                    "value": "enterprise "
                  },
                  {
                    "label": "no",
                    "value": ""
                  }
                ]
              },
              "visible": true
            },
            {
              "name": "license3",
              "type": "Microsoft.Common.OptionsGroup",
              "label": "Install temporary DNS license",
              "defaultValue": "yes",
              "toolTip": "Select yes if you want to install temporary DNS license",
              "constraints": {
                "allowedValues": [
                  {
                    "label": "yes",
                    "value": "dns "
                  },
                  {
                    "label": "no",
                    "value": ""
                  }
                ]
              },
              "visible": true
            },
            {
              "name": "license4",
              "type": "Microsoft.Common.OptionsGroup",
              "label": "Install temporary CNA license",
              "defaultValue": "yes",
              "toolTip": "Select yes if you want to install temporary CNA license",
              "constraints": {
                "allowedValues": [
                  {
                    "label": "yes",
                    "value": "cloud "
                  },
                  {
                    "label": "no",
                    "value": ""
                  }
                ]
              },
              "visible": "[or(equals(basics('niosModel'), 'vnios-te-v820'), equals(basics('niosModel'), 'vnios-te-v1420'), equals(basics('niosModel'), 'vnios-te-v2220'))]"
            },
            {
              "name": "license5",
              "type": "Microsoft.Common.OptionsGroup",
              "label": "Install temporary Cloud Platform license",
              "defaultValue": "yes",
              "toolTip": "Select yes if you want to install temporary Cloud Platform license",
              "constraints": {
                "allowedValues": [
                  {
                    "label": "yes",
                    "value": "cloud_api "
                  },
                  {
                    "label": "no",
                    "value": ""
                  }
                ]
              },
              "visible": "[or(equals(basics('niosModel'), 'vnios-cp-v800'), equals(basics('niosModel'), 'vnios-cp-v1400'), equals(basics('niosModel'), 'vnios-cp-v2200'))]"
            },
            {
              "name": "licensesList",
              "type": "Microsoft.Common.TextBox",
              "label": "List of available license.",
              "defaultValue": "",
              "toolTip": "Enter the space separated list of additional temp licenses if any",
              "constraints": {
                "required": false
              },
              "visible": true
            }
          ],
          "visible": true
        },
        {
          "name": "customData",
          "type": "Microsoft.Common.FileUpload",
          "label": "Upload file with custom data if needed.",
          "toolTip": "Some custom data parameter are not available for Azure, please refer to Azure NIOS Guide for allowed parameters",
          "constraints": {
            "required": false,
            "accept": ".yaml"
          },
          "options": {
            "multiple": false,
            "uploadMode": "file",
            "openMode": "text",
            "encoding": "UTF-8"
          },
          "visible": true
        }
      ]
    }],
    "outputs": {
      "customData": "[concat(coalesce(steps('vmSettings').customData, ''), replace('#n#r', '#', string(\\)), 'temp_license: ', steps('vmSettings').licenseSection.license1, steps('vmSettings').licenseSection.license2, steps('vmSettings').licenseSection.license3, coalesce(steps('vmSettings').licenseSection.license4, ''), coalesce(steps('vmSettings').licenseSection.license5, ''), coalesce(steps('vmSettings').licenseSection.licensesList, ''))]"
    }
  }
}
